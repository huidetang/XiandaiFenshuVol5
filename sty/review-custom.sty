% for user-defined macro
\usepackage{niceframe}

\jlreqsetup{endnote_position={_chapter}}

\renewcommand{\reviewbibref}[2]{\cite{#2}}

\if@tate
  \def\@cite#1{\tatechuyoko{[#1]}}
  \def\@biblabel#1{\tatechuyoko{[#1]}}
\fi

\patchcmd{\addcontentsline}{\thepage}{\tatechuyoko{\thepage}}{}{}

\makeatletter

% titlepage
\ifdefined\review@titlepage
  \ifthenelse{\isundefined{\review@titlefile}}{%
    \def\reviewtitlepagecont{%
       \jlreq@oldfontcommand@enable
       \jlreq@iftdir{\clearpage\yoko\jlreq@resttatetrue}{\jlreq@resttatefalse}% 常に横書きにする
       \begin{titlepage}
       \thispagestyle{empty}
       \begin{center}%
       \niceframe{%
       \mbox{}%
       \vskip5\zw
       %\reviewtitlefont%
       {\Huge\review@booktitlename\par}%
       \ifdefined\review@subtitlename
         \vskip 1em%
         {\Large\review@subtitlename\par}%
       \fi
       \vskip 15em%
       {\huge
       \lineskip .75em
       \begin{tabular}[t]{p{\textwidth}}%
       \centering\review@titlepageauthors
       \end{tabular}\par}%
       \vfill
       {\large\review@date \review@intn@edition%
         \hspace{2\zw}%
         \review@intn@publishedby\par}%
       \vskip4\zw\mbox{}
       }
       \end{center}%
       \end{titlepage}\clearpage
       \ifx\jlreq@theindex@savedpagestyle\@undefined\else\expandafter\pagestyle\expandafter{\jlreq@theindex@savedpagestyle}\fi
       \let\jlreq@theindex@savedpagestyle\@undefined
       \ifjlreq@resttate\tate\fi
       \jlreq@oldfontcommand@disable
    }
  }{%
    \def\reviewtitlepagecont{\review@titlefile}
  }
\fi

% colophon
\ifdefined\review@colophon
  \ifthenelse{\isundefined{\review@colophonfile}}{%
    \def\reviewcolophonpagecont{%
\jlreq@oldfontcommand@enable
\jlreq@iftdir{\clearpage\yoko\jlreq@resttatetrue}{\jlreq@resttatefalse}% 常に横書きにする
\reviewcolophon
\thispagestyle{empty}
\vspace*{\fill}
{\noindent\reviewtitlefont\Large\review@booktitlename}\\
\ifdefined\review@subtitlename
{\noindent\reviewtitlefont\large\review@subtitlename} \\
\fi
\rule[8pt]{\textwidth}{1pt} \\
{\noindent\review@pubhistories}

\begin{tabularx}{\dimexpr\textwidth-0.5em}{lX}
\review@colophonnames
\end{tabularx}
　\\
\rule[0pt]{\textwidth}{1pt} \\
\ifdefined\review@rights
\review@rights
\fi
    }%
  }{%
    \def\reviewcolophonpagecont{\review@colophonfile}
  }
\fi

\newcolumntype{L}[1]{>{\raggedright\let\newline\\\arraybackslash\hspace{0pt}}p{#1}}
\newcolumntype{C}[1]{>{\centering\let\newline\\\arraybackslash\hspace{0pt}}p{#1}}
\newcolumntype{R}[1]{>{\raggedleft\let\newline\\\arraybackslash\hspace{0pt}}p{#1}}

\ifx\jlreq@theindex@savedpagestyle\@undefined\else\expandafter\pagestyle\expandafter{\jlreq@theindex@savedpagestyle}\fi
\let\jlreq@theindex@savedpagestyle\@undefined
\ifjlreq@resttate\tate\fi
\jlreq@oldfontcommand@disable

\makeatother